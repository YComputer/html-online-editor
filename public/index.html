<!DOCTYPE html>
<html>
    <head>
    <title>小栈 html-online-editor</title>
    <link href="./style.css" rel="stylesheet" type="text/css" />
    </head>

    <body id="main">

        <div id="editor">
        </div>

        <iframe id="preview">
        </iframe>

        <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
        <script src="http://ajaxorg.github.io/ace-builds/src-noconflict/ace.js" type="text/javascript" charset='utf-8'></script>
        <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.2/underscore-min.js" type="text/javascript" charset="utf-8"></script>-->


          <script>
            $(function(){
                // 初始化的html
                var intro = `
<!DOCTYPE html>
<html>
<body>
<style>
  body {
  padding-top: 80px;
  text-align: center;
  font-family: monaco, monospace;
  background: url(https://media.giphy.com/media/rWY9ySfjytitq/giphy.gif) 50%;
  background-size: cover;
}
h1, h2, h3, h4, h5, h6 {
  display: inline-block;
  background: #fff;
}
h1 {
  font-size: 30px
}
h2 {
  font-size: 20px;
}
span {
  background: #fd0;
}
</style>
<h1>Welcome to <span>小栈编程</span></h1><br>
<h2>(请在左边的代码编辑框输入你的代码)</h2>


</body>
</html>
`;

                window.editor = ace.edit("editor");
                editor.setTheme("ace/theme/tomorrow_night_eighties");
                editor.getSession().setMode("ace/mode/html");
                editor.setValue(intro);

                
                var iframe = document.getElementById('preview'),
                iframeWin = iframe.contentWindow || iframe,
                iframeDoc = iframe.contentDocument || iframeWin.document;

                // 可执行javascript代码，但是感觉效率有点低。
                iframeDoc.open();
                iframeDoc.write(editor.getValue());
                iframeDoc.close();
                // iframeDoc.body.innerHTML = editor.getValue();                                          
                editor.getSession().on('change', function(e) {
                  iframeDoc.open();
                  iframeDoc.write(editor.getValue());
                  iframeDoc.close();
                  // iframeDoc.body.innerHTML = editor.getValue();
                });
                
                
            })
         </script>
    </body>    
</html>